<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.yfyue.sysauth.db.inter.BjHelpDocMapper" >
  <resultMap id="BaseResultMap" type="cn.yfyue.sysauth.db.model.BjHelpDoc" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="DOC_ID" property="docId" jdbcType="BIGINT" />
    <result column="DOC_ORDER" property="docOrder" jdbcType="INTEGER" />
    <result column="DOC_TITLE" property="docTitle" jdbcType="VARCHAR" />
    <result column="DOC_CODE" property="docCode" jdbcType="VARCHAR" />
    <result column="DOC_STATE" property="docState" jdbcType="INTEGER" />
    <result column="REG_TIME" property="regTime" jdbcType="TIMESTAMP" />
    <result column="UP_TIME" property="upTime" jdbcType="TIMESTAMP" />
    <result column="EXTEND_FIELD" property="extendField" jdbcType="VARCHAR" />
    <result column="DOC_CONTENT" property="docContentByte" jdbcType="LONGVARBINARY" />
    <result column="REG_MAN" property="regMan" jdbcType="BIGINT" />
    <result column="USER_NAME" property="userName" jdbcType="CHAR" />
  </resultMap>
<!-- 
//列表
List<BjHelpDoc> getHelpDocList(@Param("docType")String docType,@Param("query_key")String query_key,
		@Param("b_time")String b_time,@Param("e_time")String e_time,
		@Param("startRow")int startRow,@Param("rowNum")int rowNum);
-->
<select id="getHelpDocList"   resultMap="BaseResultMap">
    SELECT DOC_ID,DOC_ORDER,DOC_TITLE,DOC_STATE,REG_MAN,UP_TIME,EXTEND_FIELD,USER_NAME,DOC_CODE FROM (
		SELECT a.DOC_ID,a.DOC_ORDER,a.DOC_TITLE,a.DOC_STATE,a.REG_MAN,a.DOC_CODE,a.UP_TIME,a.EXTEND_FIELD,b.USER_NAME 
		 FROM BJ_HELP_DOC a LEFT JOIN BJ_USER b ON (a.REG_MAN=b.USER_ID)
		 WHERE 1=1
               <if test="query_key !=null">
                   AND (a.DOC_TITLE LIKE '%${query_key}%' OR a.DOC_CODE LIKE '%${query_key}%') 
				</if>
			    <if test="b_time !=null">
                     AND  a.UP_TIME <![CDATA[>=]]>#{b_time,jdbcType=TIMESTAMP}
				</if>
				<if test="e_time !=null">
                     AND  a.UP_TIME <![CDATA[<=]]>#{e_time,jdbcType=TIMESTAMP}
				</if>
              ORDER BY a.DOC_ORDER ASC,a.UP_TIME DESC
         ) as Q1  LIMIT #{startRow,jdbcType=INTEGER},#{rowNum,jdbcType=INTEGER}
  </select>  
<!-- 
//验证码是否存在
int isDocCode(String docCode);
 -->  
 <select id="isDocCode"   resultType="java.lang.Integer">
   SELECT COUNT(1) FROM BJ_HELP_DOC WHERE DOC_CODE=#{docCode,jdbcType=VARCHAR}
 </select>
<!--		
//统计
int getHelpDocListCount(@Param("docType")String docType,@Param("query_key")String query_key,
		@Param("b_time")String b_time,@Param("e_time")String e_time);
-->
<select id="getHelpDocListCount"   resultType="java.lang.Integer">
  SELECT COUNT(1) FROM BJ_HELP_DOC a LEFT JOIN BJ_USER b ON (a.REG_MAN=b.USER_ID)
	 WHERE 1=1
        <if test="query_key !=null">
              AND (a.DOC_TITLE LIKE '%${query_key}%' OR a.DOC_CODE LIKE '%${query_key}%') 
		</if>
	    <if test="b_time !=null">
               AND  a.UP_TIME <![CDATA[>=]]>#{b_time,jdbcType=TIMESTAMP}
		</if>
		<if test="e_time !=null">
               AND  a.UP_TIME <![CDATA[<=]]>#{e_time,jdbcType=TIMESTAMP}
		</if>
 </select> 
<!--				
//取单个	
BjHelpDoc getHelpDocInfo(String docId);
-->
<select id="getHelpDocInfo"   resultMap="BaseResultMap">
  SELECT  DOC_ID,DOC_ORDER,DOC_CODE,DOC_TITLE,DOC_CONTENT,EXTEND_FIELD 
     FROM BJ_HELP_DOC WHERE DOC_ID=#{docId,jdbcType=BIGINT}
</select>
<!--		
//添加
int addHelpDoc(BjHelpDoc bjHelpDoc);
-->
  <insert id="addHelpDoc" parameterType="cn.yfyue.sysauth.db.model.BjHelpDoc" >
    insert into BJ_HELP_DOC (DOC_ORDER, DOC_TITLE, 
      DOC_STATE, REG_TIME, UP_TIME, 
      EXTEND_FIELD, DOC_CONTENT,REG_MAN,DOC_CODE)
    values (#{docOrder,jdbcType=INTEGER}, #{docTitle,jdbcType=VARCHAR}, 
      0, NOW(), NOW(), 
      #{extendField,jdbcType=VARCHAR}, #{docContent,jdbcType=LONGVARBINARY},
      #{regMan,jdbcType=BIGINT},#{docCode,jdbcType=VARCHAR})
  </insert>
<!--		
//删除
int delHelpDoc(String docId);
-->
<delete id="delHelpDoc">
   DELETE FROM BJ_HELP_DOC WHERE DOC_ID=#{docId,jdbcType=BIGINT}
</delete>
<!--		
//更新
int upHelpDoc(BjHelpDoc bjHelpDoc); 
 -->
<update id="upHelpDoc" parameterType="cn.yfyue.sysauth.db.model.BjHelpDoc" >
    update BJ_HELP_DOC
    <set >
      <if test="docCode != null" >
        DOC_CODE = #{docCode,jdbcType=VARCHAR},
      </if>
      <if test="docOrder != null" >
        DOC_ORDER = #{docOrder,jdbcType=INTEGER},
      </if>
      <if test="docTitle != null" >
        DOC_TITLE = #{docTitle,jdbcType=VARCHAR},
      </if>
        UP_TIME = NOW(),
      <if test="extendField != null" >
        EXTEND_FIELD = #{extendField,jdbcType=VARCHAR},
      </if>
      <if test="docContent != null" >
        DOC_CONTENT = #{docContent,jdbcType=LONGVARBINARY},
      </if>
      <if test="regMan != null" >
        REG_MAN = #{regMan,jdbcType=BIGINT},
      </if>      
    </set>
    where DOC_ID = #{docId,jdbcType=BIGINT}
  </update>
</mapper>