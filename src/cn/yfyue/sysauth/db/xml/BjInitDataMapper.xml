<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.yfyue.sysauth.db.inter.BjInitDataMapper" >
  <resultMap id="BaseResultMap" type="cn.yfyue.sysauth.db.model.BjInitData" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="INIT_DATA_ID" property="initDataId" jdbcType="BIGINT" />
    <result column="DATA_CODE" property="dataCode" jdbcType="CHAR" />
    <result column="DATA_NAME" property="dataName" jdbcType="VARCHAR" />
    <result column="TYPE_CODE" property="typeCode" jdbcType="CHAR" />
    <result column="LOG_TIME" property="logTime" jdbcType="TIMESTAMP" />
    <result column="TYPE_NAME" property="typeName" jdbcType="CHAR" />
    <result column="DATA_STATE" property="dataState" jdbcType="INTEGER" />
    <result column="EXTEND_FIELD" property="extendField" jdbcType="VARCHAR" />
  </resultMap>
 <!-- 
 //初始化数据
List<BjInitData> catchLoadInitData();
  --> 
  <select id="catchLoadInitData"  resultMap="BaseResultMap">
    SELECT DATA_CODE,DATA_NAME,TYPE_CODE,EXTEND_FIELD
       FROM BJ_INIT_DATA WHERE DATA_STATE=0 
  </select>  
  <!-- 
  //配置数据列表
List<BjInitData> getInitDataList(@Param("typeCode")String typeCode,@Param("qkey")String qkey,
		@Param("startRow")int startRow,@Param("rowNum")int rowNum);
-->
<select id="getInitDataList"   resultMap="BaseResultMap">
    SELECT INIT_DATA_ID,DATA_CODE,DATA_NAME,TYPE_CODE,LOG_TIME,TYPE_NAME,EXTEND_FIELD FROM (
		SELECT  a.INIT_DATA_ID, a.DATA_CODE, a.DATA_NAME, a.TYPE_CODE,a.LOG_TIME,b.TYPE_NAME,a.EXTEND_FIELD
		 FROM BJ_INIT_DATA a LEFT JOIN BJ_INIT_TYPE b ON (a.TYPE_CODE=b.TYPE_CODE)
		 WHERE 1=1 
		 <if test="typeCode !=null">
		      AND a.TYPE_CODE=#{typeCode,jdbcType=CHAR}
		 </if>
		<if test="qkey !=null">
		    AND (a.DATA_NAME LIKE '%${qkey}%'  OR  a.DATA_CODE LIKE '%${qkey}%') 
		</if>
              ORDER BY a.LOG_TIME DESC
         ) as Q1  LIMIT #{startRow,jdbcType=INTEGER},#{rowNum,jdbcType=INTEGER}
  </select>  
<!--
//配置数据统计
int getInitDataCount(@Param("typeCode")String typeCode,@Param("qkey")String qkey);
 -->
<select id="getInitDataCount"   resultType="java.lang.Integer">
 SELECT COUNT(1)  FROM BJ_INIT_DATA a LEFT JOIN BJ_INIT_TYPE b ON (a.TYPE_CODE=b.TYPE_CODE)
		 WHERE 1=1 
		 <if test="typeCode !=null">
		      AND a.TYPE_CODE=#{typeCode,jdbcType=CHAR}
		 </if>
		<if test="qkey !=null">
		    AND (a.DATA_NAME LIKE '%${qkey}%'  OR  a.DATA_CODE LIKE '%${qkey}%') 
		</if>
</select>
<!-- 
//验证编码是否存在
int isInitDataCode(String initDataCode);
 -->
 <select id="isInitDataCode"   resultType="java.lang.Integer">
   SELECT COUNT(1) FROM BJ_INIT_DATA WHERE DATA_CODE= #{initDataCode,jdbcType=CHAR}
</select>
 <!-- 
//添加数据
int addInitData(BjInitData bjInitData);
-->
  <insert id="addInitData" parameterType="cn.yfyue.sysauth.db.model.BjInitData" >
    insert into BJ_INIT_DATA (DATA_CODE, DATA_NAME, 
      TYPE_CODE, LOG_TIME,DATA_STATE,EXTEND_FIELD)
    values ( #{dataCode,jdbcType=CHAR}, #{dataName,jdbcType=VARCHAR}, 
      #{typeCode,jdbcType=CHAR}, NOW(),0,#{extendField,jdbcType=VARCHAR})
  </insert>
<!--
//取单个数据
BjInitData getInitDataInfo(String initDataId);
-->
<select id="getInitDataInfo"   resultMap="BaseResultMap">
    SELECT INIT_DATA_ID,DATA_CODE,DATA_NAME,
	  TYPE_CODE,DATA_STATE,LOG_TIME,EXTEND_FIELD
	FROM BJ_INIT_DATA 
	WHERE INIT_DATA_ID=#{initDataId,jdbcType=BIGINT}
</select>
<!--
//更新数据
int upInitData(BjInitData bjInitData);
-->
  <update id="upInitData" parameterType="cn.yfyue.sysauth.db.model.BjInitData" >
    update BJ_INIT_DATA
    <set >
      <if test="dataName != null" >
        DATA_NAME = #{dataName,jdbcType=VARCHAR},
      </if>
      <if test="dataState != null" >
        DATA_STATE = #{dataState,jdbcType=INTEGER},
      </if>
      <if test="extendField != null" >
        EXTEND_FIELD = #{extendField,jdbcType=INTEGER},
      </if>      
        LOG_TIME =NOW(),
    </set>
    where INIT_DATA_ID = #{initDataId,jdbcType=BIGINT}
  </update>
<!--
//删除
int delInitData(String initDataId);
  --> 
   <update id="delInitData" parameterType="cn.yfyue.sysauth.db.model.BjInitData" >
    update BJ_INIT_DATA
    <set >
        DATA_STATE = 1,
    </set>
    where INIT_DATA_ID = #{initDataId,jdbcType=BIGINT}
  </update> 
  <!-- 配置小区小区列表 -->
 <select id="getInittypecode" resultMap="BaseResultMap">
 	SELECT DATA_CODE,DATA_NAME FROM BJ_INIT_DATA WHERE TYPE_CODE='XIAOQUTYPE'
 </select>
</mapper>