<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.yfyue.sysauth.db.inter.BjRoleFunMapper" >
  <resultMap id="BaseResultMap" type="cn.yfyue.sysauth.db.model.BjRoleFun" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="ROLE_FUN_ID" property="roleFunId" jdbcType="BIGINT" />
    <result column="ROLE_ID" property="roleId" jdbcType="CHAR" />
    <result column="FUN_ID" property="funId" jdbcType="BIGINT" />
    <result column="REG_MAN" property="regMan" jdbcType="BIGINT" />
    <result column="REG_TIME" property="regTime" jdbcType="TIMESTAMP" />
    
     <result column="FUNC_NAME" property="funcName" jdbcType="CHAR" />
     <result column="FUNC_URL" property="funcUrl" jdbcType="VARCHAR" />
     <result column="FUNC_STATE" property="funcState" jdbcType="INTEGER" />
     <result column="SUPPER_FUNC_ID" property="supperFuncId" jdbcType="BIGINT" />
     <result column="IS_LEAF" property="isLeaf" jdbcType="INTEGER" />
     <result column="FUNC_ALIAS" property="funcAlias" jdbcType="CHAR" />
     <result column="FUNC_LEVEL" property="funcLevel" jdbcType="INTEGER" />
     <result column="STYLE_IMG" property="styleImg" jdbcType="VARCHAR" />
    
  </resultMap>
<!-- 
//验证是否有权使用
int isRoleFunc(@Param("roleCode")List<String> roleCode,@Param("funcId")String funcId);
 -->  
<select id="isRoleFunc"   resultType="java.lang.Integer">
   SELECT COUNT(1) FROM BJ_ROLE_FUN WHERE FUN_ID=#{funcId,jdbcType=BIGINT} AND ROLE_ID IN
   <foreach item="item" index="index" collection="roleIds" open="(" separator="," close=")">  
     #{item}  
   </foreach>    
</select>
<!-- 
//取所有的权限 all
List<BjRoleFun> getAllFuncList();
-->
<select id="getAllFuncList"   resultMap="BaseResultMap">
	SELECT  FUNC_ID AS FUN_ID,FUNC_NAME,FUNC_URL,SUPPER_FUNC_ID,
	  IS_LEAF,FUNC_ALIAS,FUNC_LEVEL,STYLE_IMG
	FROM BJ_FUNC WHERE func_state=0
	ORDER BY FUNC_ORDER ASC
</select>
<!-- 
//取接收角色已分配权限 sendeeRole
List<BjRoleFun> getRoleFuncList(String roleIds);
-->
 
<select id="getRoleFuncList" resultMap="BaseResultMap">
  SELECT DISTINCT b.FUNC_ID AS FUN_ID,b.FUNC_NAME,b.FUNC_URL,b.SUPPER_FUNC_ID,
   b.IS_LEAF,b.FUNC_ALIAS,b.FUNC_LEVEL,b.STYLE_IMG
  FROM BJ_ROLE_FUN a,BJ_FUNC b WHERE a.FUN_ID=b.FUNC_ID AND a.ROLE_ID IN
   <foreach item="item" index="index" collection="list" open="(" separator="," close=")">  
     #{item}  
   </foreach>  
</select>

<!-- 
//添加分配权限
int addRoleFun(BjRoleFun bjRoleFun);
-->
  <insert id="addRoleFun" parameterType="cn.yfyue.sysauth.db.model.BjRoleFun" >
    insert into BJ_ROLE_FUN (ROLE_ID, FUN_ID, 
      REG_MAN, REG_TIME)
    values ( #{roleId,jdbcType=CHAR}, #{funId,jdbcType=BIGINT}, 
      #{regMan,jdbcType=BIGINT}, NOW())
  </insert>
<!-- 
//按功能ID清掉权限
int delFunIdToRoleFun(String funcId);
-->
<delete id="delFunIdToRoleFun">
   DELETE FROM BJ_ROLE_FUN WHERE FUN_ID=#{funId,jdbcType=BIGINT}
</delete>
<!-- 
//按角色清掉权限
int delRoleIdToRoleFun(String roleId); 
 -->  
<delete id="delRoleIdToRoleFun">
   DELETE FROM BJ_ROLE_FUN WHERE ROLE_ID=#{roleId,jdbcType=CHAR}
</delete>  

 
</mapper>