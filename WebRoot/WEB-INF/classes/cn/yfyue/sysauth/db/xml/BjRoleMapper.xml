<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.yfyue.sysauth.db.inter.BjRoleMapper" >
  <resultMap id="BaseResultMap" type="cn.yfyue.sysauth.db.model.BjRole" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="ROLE_ID" property="roleId" jdbcType="BIGINT" />
    <result column="ROLE_NAME" property="roleName" jdbcType="VARCHAR" />
    <result column="ROLE_KEY" property="roleKey" jdbcType="VARCHAR" />
    <result column="ROLE_STATE" property="roleState" jdbcType="INTEGER" />
    <result column="UP_TIME" property="upTime" jdbcType="TIMESTAMP" />
    <result column="ORGE_FULL_NAME" property="orgeFullName" jdbcType="VARCHAR" />
  </resultMap>
<!-- 
//添加
int addRole(BjRole bjRole);	
-->
<insert id="addRole" parameterType="cn.yfyue.sysauth.db.model.BjRole" >
   insert into BJ_ROLE (ROLE_NAME, ROLE_KEY, 
     ROLE_STATE, UP_TIME)
   values (#{roleName,jdbcType=VARCHAR}, #{roleKey,jdbcType=VARCHAR}, 
     0, NOW())
</insert>
<!-- 
//分配时取出所有角色
List <BjRole> getAllRoleList(@Param("qkey")String qkey);
 -->
<select id="getAllRoleList" resultMap="BaseResultMap">
  SELECT a.ROLE_ID,a.ROLE_NAME,a.ROLE_KEY,a.ROLE_STATE,a.UP_TIME,b.ORGE_FULL_NAME 
    FROM BJ_ROLE a LEFT JOIN BJ_ORGE b ON (a.ROLE_KEY=b.ORGE_ID) 
   WHERE a.ROLE_STATE=0 
    <if test="qkey !=null">
        AND a.ROLE_NAME LIKE '%${qkey}%'
    </if> 
      ORDER BY a.UP_TIME  DESC  
</select> 
<!--
//列表
List <BjRole> getRoleList(@Param("qkey")String qkey,
		@Param("startRow")int startRow,@Param("rowNum")int rowNum);
-->
<select id="getRoleList" resultMap="BaseResultMap">
  SELECT ROLE_ID,ROLE_NAME,ROLE_KEY,ROLE_STATE,UP_TIME,ORGE_FULL_NAME FROM (
    SELECT a.ROLE_ID,a.ROLE_NAME,a.ROLE_KEY,a.ROLE_STATE,a.UP_TIME,b.ORGE_FULL_NAME 
     FROM BJ_ROLE a LEFT JOIN BJ_ORGE b ON (a.ROLE_KEY=b.ORGE_ID) 
     WHERE a.ROLE_STATE=0 
     <if test="qkey !=null">
         AND a.ROLE_NAME LIKE '%${qkey}%'
	 </if> 
       ORDER BY a.UP_TIME  DESC
   ) as Q1  LIMIT #{startRow,jdbcType=INTEGER},#{rowNum,jdbcType=INTEGER}    
</select>
<!--		
//列表统计
int getRoleListNum(String qkey);
-->
<select id="getRoleListNum" resultType="java.lang.Integer">
  SELECT COUNT(1) FROM BJ_ROLE a
    WHERE a.ROLE_STATE=0 
    <if test="qkey !=null">
       AND a.ROLE_NAME LIKE '%${qkey}%'
	</if> 
</select>
<!--
//更新
int upJiaoSe(BjRole bjRole);
-->
  <update id="upJiaoSe" parameterType="cn.yfyue.sysauth.db.model.BjRole" >
    update BJ_ROLE
    <set >
      <if test="roleName != null" >
        ROLE_NAME = #{roleName,jdbcType=VARCHAR},
      </if>
      <if test="roleKey != null" >
        ROLE_KEY = #{roleKey,jdbcType=VARCHAR},
      </if>
        UP_TIME = NOW(),
    </set>
    where ROLE_ID = #{roleId,jdbcType=BIGINT}
  </update>
<!--
//删除
int delRole(String roleId);
-->
<delete id="delRole">
  DELETE FROM BJ_ROLE WHERE ROLE_ID=#{roleId,jdbcType=BIGINT}
</delete>
<!--
//是否分配角色功能
int isFuncToRole(String roleId);
-->
<select id="isFuncToRole" resultType="java.lang.Integer">
  SELECT COUNT(1) FROM BJ_ROLE_FUN WHERE ROLE_ID=#{roleId,jdbcType=BIGINT}
</select>
<!--
//是否分配到用户
int isRoleToUser(String roleId);
-->
<select id="isRoleToUser" resultType="java.lang.Integer">
  SELECT COUNT(1) FROM BJ_USER_ROLE WHERE ROLE_ID=#{roleId,jdbcType=BIGINT}
</select>
<!--
//取单个	
BjRole getRoleInfo(String roleId); 
 -->  
<select id="getRoleInfo" resultMap="BaseResultMap">
  SELECT ROLE_ID,ROLE_NAME,ROLE_KEY,ROLE_STATE,UP_TIME 
	FROM BJ_ROLE WHERE ROLE_ID=#{roleId,jdbcType=BIGINT}
</select>  


</mapper>