<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.yfyue.yyzt.db.inter.OpOrgeMapper" >
  <resultMap id="BaseResultMap" type="cn.yfyue.yyzt.db.model.OpOrge" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="ORGE_ID" property="orgeId" jdbcType="BIGINT" />
    <result column="ORGE_NAME" property="orgeName" jdbcType="VARCHAR" />
    <result column="ORGE_LEVEL" property="orgeLevel" jdbcType="INTEGER" />
    <result column="SUPERIOR_ORGE_ID" property="superiorOrgeId" jdbcType="BIGINT" />
    <result column="USER_ID" property="userId" jdbcType="BIGINT" />
    <result column="LOAD_TIME" property="loadTime" jdbcType="TIMESTAMP" />
    <result column="UP_TIME" property="upTime" jdbcType="TIMESTAMP" />
    <result column="ORGE_FULL_NAME" property="orgeFullName" jdbcType="VARCHAR" />
    <result column="ORGE_STATE" property="orgeState" jdbcType="INTEGER" />
    
    <result column="ORGE_ADDR" property="orgeAddr" jdbcType="VARCHAR" />    
    <result column="ORGE_TEL" property="orgeTel" jdbcType="VARCHAR" />   
    <result column="E_MAIL" property="email" jdbcType="VARCHAR" />
    <result column="LINK_MAN" property="linkMan" jdbcType="VARCHAR" />  
    <result column="ORGE_TYPE" property="orgeType" jdbcType="VARCHAR" />          
  </resultMap>
<!-- 
//取所有部门
List<OpOrge> getOrgeList(@Param("qkey")String qkey,
		@Param("startRow")int startRow, 
		@Param("rowNum")int rowNum);
--> 
<select id="getOrgeList" resultMap="BaseResultMap">
 SELECT ORGE_ID,ORGE_NAME,ORGE_FULL_NAME, ORGE_ADDR, ORGE_TEL, E_MAIL, LINK_MAN, ORGE_TYPE, UP_TIME FROM (
  SELECT ORGE_ID,ORGE_NAME,ORGE_FULL_NAME, ORGE_ADDR, ORGE_TEL, E_MAIL, LINK_MAN, ORGE_TYPE, UP_TIME
    FROM OP_ORGE WHERE 1=1
    <if test="qkey != null" >
      (ORGE_NAME LIKE '%${qkey}%' OR ORGE_FULL_NAME LIKE '%${qkey}%' OR ORGE_TEL LIKE '${qkey}%')
    </if>    
    ORDER BY UP_TIME DESC) AS Q1 LIMIT #{startRow,jdbcType=INTEGER},#{rowNum,jdbcType=INTEGER}    
</select>
<!-- 
//统计
int getOrgeListCount(@Param("qkey")String qkey);
-->
<select id="getOrgeListCount" resultType="java.lang.Integer">
  SELECT COUNT(1) FROM OP_ORGE WHERE 1=1
    <if test="qkey != null" >
      (ORGE_NAME LIKE '%${qkey}%' OR ORGE_FULL_NAME LIKE '%${qkey}%' OR ORGE_TEL LIKE '${qkey}%')
    </if>    
</select> 
<!-- 
//添加
int addOrge(OpOrge opOrge);
-->
<insert id="addOrge" parameterType="cn.yfyue.yyzt.db.model.OpOrge" useGeneratedKeys="true" keyProperty="orgeId">
  insert into OP_ORGE (ORGE_NAME, ORGE_LEVEL,ORGE_STATE, 
    SUPERIOR_ORGE_ID, USER_ID, LOAD_TIME, UP_TIME,ORGE_FULL_NAME,
    ORGE_ADDR,ORGE_TEL,E_MAIL,LINK_MAN,ORGE_TYPE)
  values (#{orgeName,jdbcType=CHAR}, #{orgeLevel,jdbcType=INTEGER}, #{orgeState,jdbcType=INTEGER}, 
    #{superiorOrgeId,jdbcType=BIGINT}, #{userId,jdbcType=BIGINT}, NOW(), NOW(),
    #{orgeFullName,jdbcType=VARCHAR},#{orgeAddr,jdbcType=VARCHAR},
    #{orgeTel,jdbcType=VARCHAR},#{email,jdbcType=VARCHAR},
    #{linkMan,jdbcType=VARCHAR},#{orgeType,jdbcType=VARCHAR}
    )
</insert>
<!-- 
//门店名称是否存在
int isOrgeName(String orgeName);
-->
<select id="isOrgeName" resultType="java.lang.Integer">
   SELECT COUNT(1) FROM OP_ORGE WHERE ORGE_NAME=#{orgeName,jdbcType=CHAR}
</select>
<!--
//取单个
OpOrge getOrgeInfo(String orgeId);
-->
<select id="getOrgeInfo" resultMap="BaseResultMap">
   SELECT ORGE_ID,ORGE_NAME,ORGE_LEVEL,SUPERIOR_ORGE_ID,ORGE_FULL_NAME,
     ORGE_STATE,ORGE_ADDR,ORGE_TEL,E_MAIL,LINK_MAN,ORGE_TYPE,LOAD_TIME,UP_TIME
      FROM OP_ORGE WHERE ORGE_ID=#{orgeId,jdbcType=BIGINT}
</select>    
<!--
//更新
int upOrge(OpOrge opOrge);
-->
  <update id="upOrge" parameterType="cn.yfyue.yyzt.db.model.OpOrge" >
    update OP_ORGE
    <set >
        ORGE_ADDR= #{orgeAddr,jdbcType=VARCHAR},
        ORGE_TEL= #{orgeTel,jdbcType=VARCHAR},
        E_MAIL= #{email,jdbcType=VARCHAR},
        LINK_MAN= #{linkMan,jdbcType=VARCHAR},
      <if test="orgeFullName !=null">
        ORGE_FULL_NAME= #{orgeFullName,jdbcType=CHAR},
      </if>
      <if test="orgeName != null" >
        ORGE_NAME = #{orgeName,jdbcType=CHAR},
      </if>
      <if test="userId != null" >
        USER_ID = #{userId,jdbcType=BIGINT},
      </if>
        LOAD_TIME = NOW(),
    </set>
    where ORGE_ID = #{orgeId,jdbcType=BIGINT}
  </update>
<!--
//删除
int delOrge(String orgeId);
-->
<delete id="delOrge">
  DELETE FROM OP_ORGE WHERE ORGE_ID=#{orgeId,jdbcType=BIGINT}
</delete>
<!--
//是否下级
int getOrgeIsChild(String orgeId); 
 -->
 <select id="getOrgeIsChild" resultType="java.lang.Integer">
    SELECT COUNT(1) FROM OP_ORGE WHERE SUPERIOR_ORGE_ID=#{orgeId,jdbcType=BIGINT}
 </select>
<!-- 
//是否已使用
int getOrgeIsUse(String orgeId);
 -->
 <select id="getOrgeIsUse" resultType="java.lang.Integer">
    SELECT COUNT(1) FROM OP_USER WHERE ORGE_ID=#{orgeId,jdbcType=BIGINT}
 </select>
</mapper>